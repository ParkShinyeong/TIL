## 가비지 컬랙션

프로그램에서 더이상 사용하지 않는 메모리를 자동으로 정리하는 것.

이 기능을 가진 언어(혹은 엔진)은 자바, C#, 자바스크립트 등이 있다.

### 가비지 컬랙션의 방법

**1. 트레이싱**

한 객체에 **flag**를 두고, **가비지 컬랙션의 사이클마다 flag를 표시 후 삭제**하는 **mark and sweep** 방법이다.

객체에 **in-use flag**를 두고, 사이클마다 **메모리 관리자가 모든 객체를 추적**해서 사용 중인지 아닌지를 표시**(mark)**한다. 그 후 **표시되지 않은 객체를 삭제(sweep)**하는 단계를 통해 메모리를 해제한다.

**2. 레퍼런스 카운팅**

한 객체를 참조하는 변수의 수를 추적하는 방법

객체를 참조하는 변수는 처음에는 특정 메모리에 대해 레퍼런스가 하나뿐이지만, 변수의 레퍼런스가 복사될 때마다 레퍼런스 카운트가 늘어난다.

객체를 참조하고 있던 변수의 값이 바뀌거나, 변수 스코프를 벗어나면 레퍼런스 카운트가 줄어든다.

레퍼런스 카운트가 0이 되면, 그 객체와 관련한 메모리는 비울 수 있다.

- 레퍼런스 카운트가 0이 되는 것 → 아무도 그 객체에 대한 레퍼런스를 가지고 있지 않다.

## 캐시

[(캐싱 개요)](https://aws.amazon.com/ko/caching/)

일시적인 특징을 가진 데이터 하위 집단을 저장하는 고속 데이터 저장 공간

캐시의 데이터는 일반적으로 **RAM (random access memory)**에 저장되어 있다. **빠르게 액세스** 할 수 있으며, 기본 스토리지 계층(HDD, SSD)에 액세스 할 필요를 줄임으로 **데이터 검색 성능을 높인다.**

- **RAM/메모리 엔진** → 높은 요청 비율과 IOPS(초당 입력/ 출력 작업)을 지원
  > ❓ **IOPS (읽기 처리량)**: input/output operations per second. HDD, SSD 등의 컴퓨터 저장 장치의 성능 측정 단위
  - 캐싱을 사용하면 대규모 데이터 검색 성능이 향상되고, 비용이 절감된다.
  - 이전에 검색하거나 계산한 데이터를 효율적으로 재사용할 수 있다.
  - 캐시는 속도를 위해 용량을 절충한다.
- **기본 스토리지 계층 (HDD, SSD)**
  - 완전하고 영구적인 데이터가 저장되어 있다.
  - 액세스 하려면 속도가 느리고, 동일한 규모의 데이터 검색 성능을 지원하기 위해서 추가 리소스가 필요하므로 비용이 상승한다. 그럼에도 인 메모리 캐시에서 제공하는 짧은 지연 시간 성능을 달성할 수 없다.

### 캐시의 장점

- **애플리케이션 성능 개선**
  - 메모리는 디스크보다 훨씬 속도가 빠르기 때문에, 인 메모리 캐시에서 데이터를 읽는 속도가 매우 빠르다.
  - 이런 빠른 데이터 액세스가 애플리케이션의 전반적인 성능을 개선한다.
- **데이터베이스 비용 절감**
  - 단일 캐시 인스턴스는 수십만 IOPS를 제공한다.
  - 이는 수많은 데이터베이스 인스턴스를 대체할 수 있으므로, 총 비용이 절감된다.
    (기본 데이터베이스에서 처리량당 요금이 부과되는 경우, 비용 절감 이점이 훨씬 커진다.)
- **백엔드 부하 감소**
  - 캐싱은 읽기 로드의 상당 부분을 백엔드 데이터베이스에서 인메모리 계층으로 리디렉션한다.
    ⇒ 데이터베이스의 로드를 줄이고, 로드 시에 성능 저하나 작업 급증 시 작동이 중단되지 않도록 보호한다.
- **예측 가능한 성능**
  - 애플리케이션의 사용량이 급증할 때 대비하는 것이 중요한데, 데이터베이스의 로드가 증가하면 데이터베이스를 가져오는데 있어 지연 시간이 길어지고, 전반적인 애플리케이션 성능이 예측 불가능해진다.
    ex) 슈퍼볼, 선거 기간 동안의 소셜 앱, 블랙 프라이데이 기간 동안 전자 상거래 앱 등
  - 인 메모리 캐시는 높은 처리량을 가지므로 이 문제를 완화할 수 있다.
- **데이터베이스 핫스팟 제거**
  - 유명한 연예인의 프로필이나, 인기 있는 제품 같은 작은 데이터 하위 집합이 다른 데이터베이스의 부분에 비해 더 자주 액세스 된다.
    ⇒ 이렇게 더 자주 액세스 되는 데이터를 **데이터베이스 핫스팟**이라고 한다.
  - 자주 사용되는 데이터 처리량 요구 사항에 맞추어, 데이터베이스 리소스를 초과 [프로비저닝](https://www.redhat.com/ko/topics/automation/what-is-provisioning)해야 할 수 있다. 예측 가능한 빠른 성능을 제공하는 동시에 초과 프로비저닝의 필요성을 줄일 수 있다.
- **IOPS(읽기 처리량) 증가**
  - 인 메모리 시스템은 지연 시간을 줄이고, 유사한 디스크 기반 데이터베이스에 훨씬 높은 요청 속도(IOPS)를 제공한다.
  - 분산형 사이드 캐시로 사용되는 단일 인스턴스는 초당 수십만건의 요청을 처리할 수 있다.

### 캐시의 적용

- 운영 체제, 네트워킹 계층(콘텐츠 전송 네트워크 (CDN), DNS 등) , 웹 애플리케이션 및 데이터베이스를 비롯한 다양한 기술 계층에서 사용한다.

- **웹 서비스**

  - 클라이언트: HTTP 캐시 헤더, 브라우저
  - 네트워크: DNS서버, HTTP 캐시 헤더, CDN, 리버스 프록시
  - 서버 및 데이터베이스 : 키-값 데이터 스토어(e.g. Redis), 로컬 캐시 (인 메모리, 디스크)

- 읽기 집얍적인 애플리케이션의 워크로드 지연 시간을 줄이고 IOPS 개선
  - Q&A 포털, 게임, 미디어 공유 및 소셜 네트워킹
- 캐싱되는 정보
  - 데이터베이스 쿼리 결과
  - 컴퓨팅 집약적인 계산
  - API 요청-응답 및 HTML
  - JavaScript 및 이미지 파일과 같은 웹 아티팩트
- 컴퓨팅 집약적 워크로드
  - 추천 엔진, 고성능 컴퓨팅 시뮬레이션 같은 데이터 세트를 조작하는 것 등
    ⇒ 수백 개의 노드에 걸쳐있는 시스템 클러스터에서 매우 큰 데이터 세트를 실시간으로 액세스 해야한다. (기본 하드웨어의 속도 때문에 디스크 기반 스토어에서 이 데이터를 조작하는 것은 이러한 애플리케이션에 심한 병목 현상을 초래한다.)
  - 캐시 역할을 하는 인 메모리 데이터 계층의 이점을 활용한다.

> ❓ **워크로드**
>
> 주어진 기간에 시스템에 의해 실행되어야 할 작업의 할당량의 의미
>
> 혹은
>
> 고객 대면 어플리케이션이나 백엔드 프로세스 같이 비지니스 가치를 창출하는 리소스 및 코드 모음

### 설계 패턴

**분산 컴퓨팅 환경**에서 **전용 캐싱 계층**을 사용한다. (분산 캐싱 환경)

- 시스템과 애플리케이션이 캐시에 영향을 주는 위험 부담 없이 자체 수명 주기를 통해 캐시와 독립적으로 실행될 수 있다
- **캐시 ⇒ 자체 수명 주기, 아키텍처 토폴로지 사용** ⇒ 서로 다른 시스템에서 액세스 할 수 있는 **중앙 계층 역할**을 한다.
  - 여러 캐시 서버에 분산된 데이터가 중앙 위치에 저장되므로, 해당 데이터의 모든 소비자가 이익을 얻을 수 있다.
  - 특히 애플리케이션 노드를 동적으로 확장 및 축소할 수 있는 시스템에 적절하다.

만약

- **캐시를 사용하는 애플리케이션** 또는 **시스템과 동일한 노드**에 캐시가 상주하는 경우

  - 애플리케이션 노드를 동적으로 확장 및 축소할 때 **캐시의 무결성에 영향**을 줄 수 있다.

- **로컬 캐시를 사용하는 경우** ⇒ 데이터를 소비하는 로컬 애플리케이션에만 도움이 된다.

### 모범 사례

캐싱되는 데이터의 유효성을 이해하는 것이 중요하다.

- 성공적인 캐시 ⇒ 높은 적중률! ⇒ 즉, 가져온 데이터가 캐시에 존재한다.
- 캐시 비적중 ⇒ 가져온 데이터가 캐시에 없다.

TTL(Time To Live) 같은 제어 항목을 적용하여 이에 따라 데이터를 만료되도록 할 수 있다.

캐시 환경이 고가용성일 필요가 있을 때 ⇒ Redis 같은 인메모리 엔진을 사용

- 기본 위치에서 데이터를 캐싱 하는 것이 아닌, 인 메모리 계층을 독립적인 데이터 스토리지 계층으로 사용한다.
- 인 메모리 엔진에 상주하는 데이터에 대해 적절한 RTO, RPO를 정의하여 이것이 적합한지 파악한다.
  - **RTO (복구 목표 시간):** 가동 중단으로부터 복구하는 데 걸리는 시간)
  - **RPO (목표 복구 시점)**: 복구 시 캡처 된 최종 시점, 또는 트랜잭션

| 계층      | 클라이언트 측                                                           | DNS                | 웹                                                                                  | 앱                                                                                       | 데이터베이스                                     |
| --------- | ----------------------------------------------------------------------- | ------------------ | ----------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------- | ------------------------------------------------ |
| 사용 사레 | 웹 사이트에서 웹 콘텐츠를 검색하는 속도 가속화 (브라우저 또는 디바이스) | 도메인과 IP간 확인 | 웹 또는 앱 서버에서 웹 콘텐츠를 검색하는 속도를 높인다. 웹 세션 관리 (서버 측)      | 애플리케이션 성능 및 데이터 액세스 가속화                                                | 데이터베이스 쿼리 요청과 관련한 지연 시간 단축   |
| 기술      | HTTP 캐시 헤더, 브라우저 DNS 서버                                       |                    | HTTP 캐시 헤더, CDN, 역방향 프록시, 웹 액셀러레이터, 키-값 스토어                   | 키-값 데이터 스토어, 로컬 캐시                                                           | 데이터베이스 버퍼, 키-값 데이터 스토어           |
| 솔루션    | 브라우저 별                                                             | Amazon Route 53    | Amazon Cloud Front, ElastiCache for Redis, ElastiCache for Memcached, 파트너 솔루션 | 애플리케이션 프레임워크, ElastiCache for Redis, ElastiCache for Memcached, 파트너 솔루션 | ElastiCache for Redis, ElastiCache for Memcached |
